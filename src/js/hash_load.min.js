!function(){function a(a){this.option={load:"switch",tab:"switch",target:document,cache:!1},this.option=$.extend(this.option,a),this.order=0,this._prev_url="",this._timer={_tab_timer:null,_load_timer:null}}a.prototype={_getHashParam:function(a,e){var t=new RegExp("(#|&)"+e+"=([^&]*)(&|$)"),i=a.match(t);return null!=i?decodeURI(i[2]):""},_parse:function(a){var e,t=$("<div></div>");return t.get(0).innerHTML=a,e=t.children()},_include:function(a,e){var t=this;if(e.html(a),window.Zepto)for(var i in a.selector)"script"===a.selector[i].nodeName.toLowerCase()&&a.selector[i].src&&t._loadScript(a.selector[i].src)},_loadScript:function(a){$.ajax({async:!1,url:a})},init:function(){var a=this,e=(this.option,"click");$.fn.tap&&(e="tap"),$(document).on(e,"a",function(){var e=$(this).attr("href");if("false"!=$(this).attr("data-ajax")&&!e.match(/^(javascript\:|#$|$)/)){var t=e,i=$(this).attr("data-hash-load")||a.option.load,s=$(this).attr("data-hash-tab")||a.option.tab,r=$(this).attr("data-hash-cache")||a.option.cache;return a.setHash(t,i,s,r),!1}}),"tap"===e&&$(document).on("click","a",function(){var a=$(this).attr("href");return"false"==$(this).attr("data-ajax")||a.match(/^(javascript\:|#$|$)/)?void 0:!1}),window.location.hash&&a.analysisHash(),window.onhashchange=function(){a.analysisHash()}},setHash:function(a,e,t,i){var s=this,h=window.location.hash;order=s.order+1,tab="",url="",reg=new RegExp(/^([^\#]*)(\#[^\#]+|)$/),r=a.match(reg),url=r[1]||s._getHashParam(h,"url"),tab=r[2]||"",tab=tab.replace("#",""),window.location.hash="url="+url+"&tab="+tab+"&load_type="+e+"&tab_type="+t+"&order="+order+"&cache="+i},updateFunc:function(a,e){var t=this;if("tab"!=a||"load"!=a)throw"没有这个扩展方法类型";t["_"+a+"_func"]=$.extend(t["_"+a+"_func"],e)},location:function(a,e,t,i){var s=this,r=(window.location.hash,a),h=e||s.option.load,o=t||s.option.tab,n=i||s.option.cache;if(!a)throw"没有设置url";s.setHash(r,h,o,n)},analysisHash:function(){var a=this,e=window.location.hash,t=a._getHashParam(e,"url"),i=1,s=a._getHashParam(e,"tab"),r=a._getHashParam(e,"load_type"),h=a._getHashParam(e,"tab_type"),o=a._getHashParam(e,"order"),n=a._getHashParam(e,"cache");$(window).trigger("hashChangeInfo",[t,s,r,h,o,n]),t!==a._prev_url&&(i=0,a._prev_url=t),s?a.tab(i):a.load()},tab:function(a){function e(a){if(!t._tab_func[r])throw'没有名为"'+r+'"的tab函数';$(a).trigger("pageBeforeLoaded"),t._tab_func[r].call(t,a,{hashTabBeforeShow:function(){$(a).trigger("hashTabBeforeShow")},hashTabShow:function(){$(a).trigger("hashTabShow")},hashTabHide:function(a){a.trigger("hashTabHide")}})}var t=this,i=window.location.hash,s=(t._getHashParam(i,"url"),"#"+t._getHashParam(i,"tab")),r=t._getHashParam(i,"tab_type")||t.option.tab,h=parseInt(t._getHashParam(i,"order"))||this.order;1===a?e(s):t.load(function(){e(s)}),this.order=h},_tab_func:{display:function(a,e){e.hashTabHide.call(this,$(a).siblings(".hash-tab.cur")),e.hashTabBeforeShow.call(),$(a).siblings(".hash-tab").removeClass("cur"),$(a).addClass("cur"),e.hashTabShow.call()},"switch":function(a,e){var t=this;if(t._timer._tab_timer)return!1;e.hashTabBeforeShow.call();var i=$(a).parent(),s=$(a).prevAll(".cur"),r=$(a).nextAll(".cur");0===s.length&&0===r.length?($(a).addClass("cur"),e.hashTabShow.call()):s.length>0?(e.hashTabHide.call(this,s),i.addClass("hash-tab-in"),$(a).addClass("active"),t._timer._tab_timer=setTimeout(function(){i.removeClass("hash-tab-in"),s.removeClass("cur"),$(a).removeClass("active").addClass("cur"),e.hashTabShow.call(),t._timer._tab_timer=null},1e3)):r.length>0&&(e.hashTabHide.call(this,r),i.addClass("hash-tab-out"),$(a).addClass("active"),t._timer._tab_timer=setTimeout(function(){i.removeClass("hash-tab-out"),r.removeClass("cur"),$(a).removeClass("active").addClass("cur"),e.hashTabShow.call(),t._timer._tab_timer=null},1e3))}},load:function(a){var e=this,t=window.location.hash,i=e._getHashParam(t,"url"),s=e._getHashParam(t,"load_type")||e.option.load,r=parseInt(e._getHashParam(t,"order"))||this.order,h=r>=this.order?"forward":"back",o="true"===e._getHashParam(t,"cache")?!0:!1,n=e.option.target;if(!i)return window.location.reload(),!1;if(o||(i+=/\?/.test(i)?"&timestamp="+(new Date).getTime():"?timestamp="+(new Date).getTime()),this.order=r,!e._load_func[s])throw'没有名为"'+s+'"的load函数';$(n).trigger("pageBeforeLoaded"),e._load_func[s].call(e,i,n,h,{hashPageLoaded:function(){$(n).trigger("hashPageLoaded")},hashPageCreated:function(){a&&a.call(),$(n).trigger("hashPageCreated")},hashPageShow:function(){$(n).trigger("hashPageShow")},hashPageUnload:function(){$(window).trigger("hashPageUnload")}})},_load_func:{page:function(a,e,t,i){$("#hash-loading").show();var s=this;i.hashPageUnload.call(),$.get(a,function(a){i.hashPageLoaded.call(),0===$(e).find(".hash-page")&&$(e).html('<div class="hash-page" data-role="page"></div>'),content=s._parse(a),s._include(content,$(e).find(".hash-page-load")),i.hashPageCreated.call(),$("#hashload-loading").hide(),i.hashPageShow.call()})},"switch":function(a,e,t,i){var s=this;if(s._timer._load_timer)return!1;i.hashPageUnload.call();var r='<div class="hash-page-load-con"><div class="spinner"><div class="spinner-container container1"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div><div class="circle4"></div></div><div class="spinner-container container2"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div><div class="circle4"></div></div><div class="spinner-container container3"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div><div class="circle4"></div></div></div></div>';if(1===$(e).find(".hash-page").length)switch(t){case"forward":$(e).append('<div class="hash-page hash-page-load" data-role="page">'+r+"</div>"),$(e).addClass("hash-page-in"),s._timer._load_timer=setTimeout(function(){$(e).removeClass("hash-page-in").find(".hash-page").eq(0).remove(),s._timer._load_timer=null},1e3);break;case"back":$(e).prepend('<div class="hash-page hash-page-load" data-role="page">'+r+"</div>"),$(e).addClass("hash-page-out"),s._timer._load_timer=setTimeout(function(){$(e).removeClass("hash-page-out").find(".hash-page").eq(1).remove(),s._timer._load_timer=null},1e3)}else $(e).append('<div class="hash-page hash-page-load" data-role="page">'+r+"</div>");$.get(a,function(a){var t;i.hashPageLoaded.call(),t=s._parse(a),s._include(t,$(e).find(".hash-page-load")),i.hashPageCreated.call(),$(e).find(".hash-page-load").removeClass("hash-page-load"),i.hashPageShow.call()})}},runScript:function(a){a&&a.call()},unScript:function(a){return a?void $(window).one("hashPageUnload",function(){a.call()}):!1}},window.hashLoad=a}(window),window.Zepto&&!function(a){if(!a)return!1;var e={nextAll:function(e){for(var t=a(),i=this.next();i.length;)("undefined"==typeof e||i.is(e))&&(t=t.add(i)),i=i.next();return t},prevAll:function(e){for(var t=a(),i=this.prev();i.length;)("undefined"==typeof e||i.is(e))&&(t=t.add(i)),i=i.prev();return t}};a.extend(a.fn,e)}(Zepto);