!function(){function a(a){this.option={load:"switch",tab:"switch",target:document,cache:!1},this.option=$.extend(this.option,a),this.order=0,this._prev_url="",this._prev_tab="",this._timer={_tab_timer:null,_load_timer:null}}a.prototype={_getHashParam:function(a,t){var e=new RegExp("(#|&)"+t+"=([^&]*)(&|$)"),i=a.match(e);return null!=i?decodeURI(i[2]):""},_parse:function(a){var t,e=$("<div></div>");return e.get(0).innerHTML=a,t=e.find('[data-role="page"]').children()},_include:function(a,t){t.html(a)},init:function(){var a=this,t=(this.option,"click");$.fn.tap&&(t="tap"),$(document).on(t,"a",function(){var t=$(this).attr("href");if("false"!=$(this).attr("data-ajax")&&!/^(javascript\:|#$|$)/.test(t)){var e=t,i=$(this).attr("data-hash-load")||a.option.load,r=$(this).attr("data-hash-tab")||a.option.tab,s=$(this).attr("data-hash-cache")||a.option.cache;return a.setHash(e,i,r,s),!1}}),"tap"===t&&$(document).on("click","a",function(){var a=$(this).attr("href");return"false"!=$(this).attr("data-ajax")||/^(#$|$)/.test(a)?!1:void 0}),window.location.hash&&(a.order=parseInt(a._getHashParam(window.location.hash,"order"))||0,a._getHashParam(window.location.hash,"tab")&&a.analysisHash()),window.onpopstate=function(){a.analysisHash()},a._script_func.run&&(a._script_func.run.call(),a._script_func.run=null)},setHash:function(a,t,e,i,s){var n=this,h=window.location.hash;return order=s?n.order+=s:n.order+1,tab="",url="",reg=new RegExp(/^([^\#]*)(\#[^\#]+|)$/),r=a.match(reg),url=r[1]||n._getHashParam(h,"url"),tab=r[2]||"",tab=tab.replace("#",""),url===n._prev_url&&tab===n._prev_tab||n._timer._tab_timer||n._timer._load_timer?!1:(history.pushState(null,"",url+"#tab="+tab+"&load_type="+t+"&tab_type="+e+"&order="+order+"&cache="+i),void n.analysisHash())},updateFunc:function(a,t){var e=this;if("tab"!=a||"load"!=a)throw"没有这个扩展方法类型";e["_"+a+"_func"]=$.extend(e["_"+a+"_func"],t)},location:function(a,t,e,i,r){var s=this,n=(window.location.hash,a),h=t||s.option.load,o=e||s.option.tab,c=i||s.option.cache;if(!a)throw"没有设置url";s.setHash(n,h,o,c,r)},analysisHash:function(){var a=this,t=window.location.hash,e=window.location.href.replace(t,""),i=1,r=a._getHashParam(t,"tab"),s=a._getHashParam(t,"load_type"),n=a._getHashParam(t,"tab_type"),h=a._getHashParam(t,"order"),o=a._getHashParam(t,"cache");a._prev_tab=r,$(window).trigger("hashChangeInfo",[e,r,s,n,h,o]),a._prev_url&&e!==a._prev_url&&(i=0,a._prev_url=e),r?a.tab(i):a.load()},getHash:function(){var a=this,t=window.location.hash,e={};return e.url=window.location.href.replace(t,""),e.tab=a._getHashParam(t,"tab"),e.load_type=a._getHashParam(t,"load_type"),e.tab_type=a._getHashParam(t,"tab_type"),e.order=a._getHashParam(t,"order"),e.cache=a._getHashParam(t,"cache"),e},tab:function(a){function t(a){if(!e._tab_func[s])throw'没有名为"'+s+'"的tab函数';return 0===$(a).length?!1:($(a).trigger("pageBeforeLoaded"),void e._tab_func[s].call(e,a,{hashTabBeforeShow:function(){$(a).trigger("hashTabBeforeShow")},hashTabShow:function(){$(a).trigger("hashTabShow")},hashTabHide:function(a){$(a).trigger("hashTabHide")}}))}var e=this,i=window.location.hash,r=(window.location.href.replace(i,""),"#"+e._getHashParam(i,"tab")),s=e._getHashParam(i,"tab_type")||e.option.tab,n=parseInt(e._getHashParam(i,"order"))||this.order;1===a?t(r):e.load(function(){t(r)}),this.order=n},_tab_func:{display:function(a,t){t.hashTabHide.call(this,$(a).siblings(".hash-tab.cur")),t.hashTabBeforeShow.call(),$(a).siblings(".hash-tab").removeClass("cur"),$(a).addClass("cur"),t.hashTabShow.call()},"switch":function(a,t){var e=this;if(e._timer._tab_timer)return!1;t.hashTabBeforeShow.call();var i=$(a).parent(),r=$(a).prevAll(".cur"),s=$(a).nextAll(".cur");0===r.length&&0===s.length?($(a).addClass("cur"),t.hashTabShow.call()):r.length>0?(t.hashTabHide.call(this,r),i.addClass("hash-tab-in"),$(a).addClass("active"),e._timer._tab_timer=setTimeout(function(){i.removeClass("hash-tab-in"),r.removeClass("cur"),$(a).removeClass("active").addClass("cur"),t.hashTabShow.call(),e._timer._tab_timer=null},500)):s.length>0&&(t.hashTabHide.call(this,s),i.addClass("hash-tab-out"),$(a).addClass("active"),e._timer._tab_timer=setTimeout(function(){i.removeClass("hash-tab-out"),s.removeClass("cur"),$(a).removeClass("active").addClass("cur"),t.hashTabShow.call(),e._timer._tab_timer=null},500))}},load:function(a){var t=this,e=window.location.hash,i=window.location.href.replace(e,""),r=t._getHashParam(e,"load_type")||t.option.load,s=parseInt(t._getHashParam(e,"order"))||this.order,n=s>this.order?"forward":"back",h="true"===t._getHashParam(e,"cache")?!0:!1,o=t.option.target;if(!i)return window.location.reload(),!1;if(h||(i+=/\?/.test(i)?"&timestamp="+(new Date).getTime():"?timestamp="+(new Date).getTime()),this.order=s,!t._load_func[r])throw'没有名为"'+r+'"的load函数';$(o).trigger("pageBeforeLoaded"),t._load_func[r].call(t,i,o,n,{hashPageLoaded:function(){$(o).trigger("hashPageLoaded")},hashPageCreated:function(){a&&a.call(),$(o).trigger("hashPageCreated")},hashPageShow:function(){$(o).trigger("hashPageShow"),t._script_func.run&&(t._script_func.run.call(),t._script_func.run=null)},hashPageUnload:function(){$(window).trigger("hashPageUnload"),t._script_func.un&&(t._script_func.un.call(),t._script_func.un=null)}})},_load_func:{page:function(a,t,e,i){$("#hash-loading").show();var r=this;i.hashPageUnload.call(),$.ajax({url:a,success:function(a){i.hashPageLoaded.call(),0===$(t).find(".hash-page")&&$(t).html('<div class="hash-page" data-role="page"></div>'),content=r._parse(a),r._include(content,$(t).find(".hash-page")),i.hashPageCreated.call(),$("#hash-loading").hide(),i.hashPageShow.call()},cache:!0})},"switch":function(a,t,e,i){function r(){$.ajax({url:a,success:function(a){var e;i.hashPageLoaded.call(),e=s._parse(a),s._include(e,$(t).find(".hash-page-load")),i.hashPageCreated.call(),$(t).find(".hash-page-load").removeClass("hash-page-load"),i.hashPageShow.call()},cache:!0})}var s=this;if(s._timer._load_timer)return!1;i.hashPageUnload.call();var n='<div class="hash-page-load-con"><div class="spinner"><div class="spinner-container container1"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div><div class="circle4"></div></div><div class="spinner-container container2"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div><div class="circle4"></div></div><div class="spinner-container container3"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div><div class="circle4"></div></div></div></div>';if(1===$(t).find(".hash-page").length)switch(e){case"forward":$(t).append('<div class="hash-page hash-page-load" data-role="page">'+n+"</div>"),$(t).addClass("hash-page-in"),s._timer._load_timer=setTimeout(function(){$(t).removeClass("hash-page-in").find(".hash-page").eq(0).remove(),s._timer._load_timer=null,r()},500);break;case"back":$(t).prepend('<div class="hash-page hash-page-load" data-role="page">'+n+"</div>"),$(t).addClass("hash-page-out"),s._timer._load_timer=setTimeout(function(){$(t).removeClass("hash-page-out").find(".hash-page").eq(1).remove(),s._timer._load_timer=null,r()},500)}else $(t).append('<div class="hash-page hash-page-load" data-role="page">'+n+"</div>")}},runScript:function(a){a&&(this._script_func.run=a)},unScript:function(a){a&&(this._script_func.un=a)},_script_func:{run:null,un:null}},window.hashLoad=a}(window);