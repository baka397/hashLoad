!function(){function a(a,e){var t=new RegExp("(#|&)"+e+"=([^&]*)(&|$)"),i=a.match(t);return null!=i?decodeURI(i[2]):""}function e(a){this.option={load:"switch",tab:"switch",target:document,cache:!1},this.option=$.extend(this.option,a),this.order=0,this.prev_url=""}e.prototype={init:function(){var a=this,e=(this.option,"click");$.fn.tap&&(e="tap"),$(document).on(e,"a",function(){var e=$(this).attr("href");if("false"!=$(this).attr("data-ajax")&&!e.match(/^(javascript\:|#$|$)/)){var t=e,i=$(this).attr("data-hash-load")||a.option.load,s=$(this).attr("data-hash-tab")||"",o=$(this).attr("data-hash-cache")||a.option.cache;a.setHash(t,i,s,o)}}),"tap"===e&&$(document).on("click","a",function(){var a=$(this).attr("href");return"false"==$(this).attr("data-ajax")||a.match(/^(javascript\:|#$|$)/)?void 0:!1}),window.location.hash&&a.analysisHash(),window.onhashchange=function(){a.analysisHash()}},setHash:function(e,t,i,s){var o=this,h=window.location.hash;order=o.order+1,tab="",url="",reg=new RegExp(/^([^\#]*)(\#[^\#]+|)$/),r=e.match(reg),url=r[1]||a(h,"url"),tab=r[2]||"",tab=tab.replace("#",""),window.location.hash="url="+url+"&tab="+tab+"&load_type="+t+"&tab_type="+i+"&order="+order+"&cache="+s},update_func:function(a,e){var t=this;if("tab"!=a||"load"!=a)throw"没有这个扩展方法类型";t[a+"_func"]=$.extend(t[a+"_func"],e)},location:function(a,e,t,i){var s=this,o=(window.location.hash,a),h=e||s.option.load,n=t||s.option.tab,r=i||s.option.cache;if(!a)throw"没有设置url";s.setHash(o,h,n,r)},analysisHash:function(){var e=this,t=window.location.hash,i=a(t,"url"),s=1,o=a(t,"tab");i!==e.prev_url&&(s=0,e.prev_url=i),o?e.tab(s):e.load()},tab:function(e){function t(a){if(!i.tab_func[h])throw'没有名为"'+h+'"的tab函数';$(a).trigger("pageBeforeLoaded"),i.tab_func[h].call(i,a,{hashTabBeforeShow:function(){$(a).trigger("hashTabBeforeShow")},hashTabShow:function(){$(a).trigger("hashTabShow")}})}var i=this,s=window.location.hash,o=(a(s,"url"),"#"+a(s,"tab")),h=a(s,"tab_type")||i.option.tab,n=parseInt(a(s,"order"))||this.order;1===e?t(o):i.load(function(){t(o)}),this.order=n},tab_func:{display:function(a,e){e.hashTabBeforeShow.call(),$(a).siblings('[data-role="page"]').removeClass("cur"),$(a).addClass("cur"),e.hashTabShow.call()},"switch":function(a,e){e.hashTabBeforeShow.call();var t=$(a).parent(),i=$(a).prevAll(".cur"),s=$(a).nextAll(".cur");0===i.length&&0===s.length?($(a).addClass("cur"),e.hashTabShow.call()):i.length>0?(t.addClass("hash-tab-in"),$(a).addClass("active"),setTimeout(function(){t.removeClass("hash-tab-in"),i.removeClass("cur"),$(a).removeClass("active").addClass("cur"),e.hashTabShow.call()},1e3)):s.length>0&&(t.addClass("hash-tab-out"),$(a).addClass("active"),setTimeout(function(){t.removeClass("hash-tab-out"),s.removeClass("cur"),$(a).removeClass("active").addClass("cur"),e.hashTabShow.call()},1e3))}},load:function(e){var t=this,i=window.location.hash,s=a(i,"url"),o=a(i,"load_type")||t.option.load,h=parseInt(a(i,"order"))||this.order,n=h>=this.order?"forward":"back",r="true"===a(i,"cache")?!0:!1,d=t.option.target;if(!s)return window.location.reload(),!1;if(r||(s+=/\?/.test(s)?"&timestamp="+(new Date).getTime():"?timestamp="+(new Date).getTime()),this.order=h,!t.load_func[o])throw'没有名为"'+o+'"的load函数';$(d).trigger("pageBeforeLoaded"),t.load_func[o].call(t,s,d,n,{hashPageLoaded:function(){$(d).trigger("hashPageLoaded")},hashPageCreated:function(){e&&e.call(),$(d).trigger("hashPageCreated")},hashPageShow:function(){$(d).trigger("hashPageShow")}})},load_func:{page:function(a,e,t,i){$("#hash-loading").show();$.get(a,function(a){i.hashPageLoaded.call(),0===$(e).find(".hash-page")&&$(e).html('<div class="hash-page" data-role="page"></div>'),$(e).find(".hash-page").html(a),i.hashPageCreated.call(),$("#hashload-loading").hide(),i.hashPageShow.call()})},"switch":function(a,e,t,i){var s='<div class="hash-page-load-con"><div class="spinner"><div class="spinner-container container1"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div><div class="circle4"></div></div><div class="spinner-container container2"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div><div class="circle4"></div></div><div class="spinner-container container3"><div class="circle1"></div><div class="circle2"></div><div class="circle3"></div><div class="circle4"></div></div></div></div>';if(1===$(e).find(".hash-page").length)switch(t){case"forward":$(e).append('<div class="hash-page hash-page-load" data-role="page">'+s+"</div>"),$(e).addClass("hash-page-in"),setTimeout(function(){$(e).removeClass("hash-page-in").find(".hash-page").eq(0).remove()},1e3);break;case"back":$(e).prepend('<div class="hash-page hash-page-load" data-role="page">'+s+"</div>"),$(e).addClass("hash-page-out"),setTimeout(function(){$(e).removeClass("hash-page-out").find(".hash-page").eq(1).remove()},1e3)}else $(e).append('<div class="hash-page hash-page-load" data-role="page">'+s+"</div>");$.get(a,function(a){i.hashPageLoaded.call(),$(e).find(".hash-page-load").html(a),i.hashPageCreated.call(),$(e).find(".hash-page-load").removeClass("hash-page-load"),i.hashPageShow.call()})}}},window.hashLoad=e}(window,Zepto||jQuery),function(a){if(!a)return!1;var e={nextAll:function(e){for(var t=a(),i=this.next();i.length;)("undefined"==typeof e||i.is(e))&&(t=t.add(i)),i=i.next();return t},prevAll:function(e){for(var t=a(),i=this.prev();i.length;)("undefined"==typeof e||i.is(e))&&(t=t.add(i)),i=i.prev();return t}};a.extend(a.fn,e)}(Zepto);